@model IEnumerable<WidgitFeedViewModel>
@{
    var widgitModel = Model.FirstOrDefault();
    var layout = (WidgitLayoutModel)ViewData["Layout"];
}
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src='https://unpkg.com/sweetalert/dist/sweetalert.min.js'></script>


<div class="container">
    <h1><b>@widgitModel.WidgitName</b></h1>
        <h4>@widgitModel.WidgitDescription</h4>
        <p id="WidgitId" hidden>@widgitModel.WidgitId</p>
        <iframe srcdoc="@widgitModel.WidgitFile" style="width:100%; height: 350px;"></iframe>
        <div class="container">
            <div class="row">
                <div class="col" style="">
                    <h3>Widgit</h3>
                    <p><img id="eye_icon" src="~/Images/view.png" class="wigit-content-icons">@widgitModel.WidgitViews</p>
                    @if(layout.Liked == true)
                    {
                        <a id="like_button" onclick="Update_Like()">
                            <p><img id="heart_icon" src="~/Images/heart.png" class="wigit-content-icons" style="">@widgitModel.WidgitLikesCount</p>
                        </a>
                    }
                    @if(layout.Liked == false)
                    {
                        <a id="like_button" onclick="Update_Like()">
                            <p><img id="heart_icon" src="~/Images/heart_unliked.png" class="wigit-content-icons" style="">@widgitModel.WidgitLikesCount</p>
                        </a>
                    }

                    @if (layout.Rated == true)
                    {
                        <p><img id="star_icon" src="~/Images/star.png" class="wigit-content-icons">@widgitModel.WidgitRating</p>
                    }
                    @if (layout.Rated == false)
                    {
                        <p><img id="star_icon" src="~/Images/star_unliked.png" class="wigit-content-icons">@widgitModel.WidgitRating
                            <select name="rating_select" id="rating_select" onchange="Update_Rating()">
                                  <option value="1">1</option>
                                  <option value="2">2</option>
                                  <option value="3">3</option>
                                  <option value="4">4</option>
                                  <option value="5">5</option>
                            </select>
                        </p>
                    }

                <p>Published -@widgitModel.PublishedDate</p>
                    <p>Updated - @widgitModel.UpdatedDate</p>
                </div>
                <div class="col">
                    <h3>Creator</h3>
                    <p><b>Creator - @widgitModel.CreatorUsername</b></p>
                </div>
            </div>

        </div>
            <textarea id="widgit_string" hidden>@widgitModel.WidgitFile</textarea>
            <button type="button" class="btn btn-primary btn-lg btn-block" onclick="Get_Widgit()">Get Widgit</button>
            
</div>

<script>
    function Update_Like() {
        var WidgitId = $("#WidgitId").text();
        $.ajax({
            type: "POST",
            url: '@Url.Action("LikeUpdate", "Widgits")',
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            data: { WidgitId: WidgitId},
            dataType: "json",
            success: function(data) {
                var return_like = data;
                if (return_like == 0) {
                    $(document).ready(function() {
                        $("#heart_icon").attr("src","/Images/heart_unliked.png");
                    });
                }
                if (return_like == 1) {
                    $(document).ready(function() {
                        $("#heart_icon").attr("src","/Images/heart.png");
                    });
                }
            },
            error: function() {
            }
        });
    }

    function Update_Rating() {
        var WidgitId = $("#WidgitId").text(); 
        var Score = $("#rating_select").find(":selected").text();
        $.ajax({
            type: "POST",
            url: '@Url.Action("RatingUpdate", "Widgits")',
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            data: { WidgitId: WidgitId, Score: Score },
            dataType: "json",
            success: function(data) {
                var return_rating = data;
                if (return_rating == 0) {
                    $(document).ready(function() {
                    });
                }
                if (return_rating == 1) {
                    $(document).ready(function() {
                        $("#star_icon").attr("src","/Images/star.png");
                    });
                }
            },
            error: function() {
            }
        });
    }

    function Get_Widgit() {
        /* Select text area by id*/
        var Text = document.getElementById("widgit_string");
        /* Select the text inside text area. */
        Text.select();
        /* Copy selected text into clipboard */
        navigator.clipboard.writeText(Text.value);
        swal({
          title: "Woo-Hoo",
          text: "Your Widgit's code has been copy to your clipboard!",
          icon: "success",
          button: "ok",
        });
    }

</script>